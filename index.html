<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¢…í•© ìš´ëª…í•™ ë¶„ì„ ì‹œìŠ¤í…œ</title>
    <link rel="stylesheet" href="assets/css/styles.css">
    
    <style>
        /* í¼ ìŠ¤íƒ€ì¼ ì¶”ê°€ */
        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .form-row .form-group {
            flex: 1;
            margin-bottom: 0;
        }

        .gender-buttons {
            display: flex;
            gap: 10px;
        }

        .gender-btn {
            flex: 1;
            padding: 12px;
            border: 2px solid #e2e8f0;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .gender-btn:hover {
            border-color: #667eea;
        }

        .gender-btn.active {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .form-group small {
            display: block;
            margin-top: 5px;
            color: #718096;
            font-size: 0.8rem;
        }

        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .form-row .form-group {
                margin-bottom: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ”® ì¢…í•© ìš´ëª…í•™ ë¶„ì„ ì‹œìŠ¤í…œ</h1>
            <p>7ê°€ì§€ ìš´ëª…í•™ ì²´ê³„ë¥¼ í†µí•©í•œ ê¹Šì´ ìˆëŠ” ë¶„ì„</p>
        </header>
        
        <main>
            <section id="input-form">
                <h2>ì¶œìƒ ì •ë³´ ì…ë ¥</h2>
                <form id="birth-form">
                    <!-- ë…„ë„ ì…ë ¥ -->
                    <div class="form-row">
                        <div class="form-group">
                            <label for="birth-year">ì¶œìƒë…„ë„:</label>
                            <input type="number" id="birth-year" min="1900" max="2024" placeholder="1978" required>
                        </div>
                        <div class="form-group">
                            <label for="birth-month">ì›”:</label>
                            <select id="birth-month" required>
                                <option value="">ì„ íƒ</option>
                                <option value="01">1ì›”</option>
                                <option value="02">2ì›”</option>
                                <option value="03">3ì›”</option>
                                <option value="04">4ì›”</option>
                                <option value="05">5ì›”</option>
                                <option value="06">6ì›”</option>
                                <option value="07">7ì›”</option>
                                <option value="08">8ì›”</option>
                                <option value="09">9ì›”</option>
                                <option value="10">10ì›”</option>
                                <option value="11">11ì›”</option>
                                <option value="12">12ì›”</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="birth-day">ì¼:</label>
                            <select id="birth-day" required>
                                <option value="">ì„ íƒ</option>
                                <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
                            </select>
                        </div>
                    </div>

                    <!-- ì‹œê°„ ì…ë ¥ -->
                    <div class="form-row">
                        <div class="form-group">
                            <label for="birth-hour">ì‹œê°„:</label>
                            <select id="birth-hour" required>
                                <option value="">ì„ íƒ</option>
                                <!-- 0ì‹œë¶€í„° 23ì‹œê¹Œì§€ -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="birth-minute">ë¶„:</label>
                            <select id="birth-minute" required>
                                <option value="">ì„ íƒ</option>
                                <!-- 0ë¶„ë¶€í„° 59ë¶„ê¹Œì§€ -->
                            </select>
                        </div>
                    </div>

                    <!-- ê¸°ì¡´ ì…ë ¥ë“¤ -->
                    <div class="form-group">
                        <label for="birth-location">ì¶œìƒì§€:</label>
                        <input type="text" id="birth-location" placeholder="ì˜ˆ: ì„œìš¸íŠ¹ë³„ì‹œ, ì°½ì›ì‹œ" required>
                        <small>ì‹œ/ë„ ë˜ëŠ” ì‹œ/êµ°/êµ¬ ë‹¨ìœ„ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”</small>
                    </div>

                    <div class="form-group">
                        <label for="gender">ì„±ë³„:</label>
                        <div class="gender-buttons">
                            <button type="button" class="gender-btn" data-value="male">ğŸ‘¨ ë‚¨ì„±</button>
                            <button type="button" class="gender-btn" data-value="female">ğŸ‘© ì—¬ì„±</button>
                        </div>
                        <input type="hidden" id="gender" required>
                    </div>

                    <button type="submit">ğŸ” ë¶„ì„ ì‹œì‘</button>
                </form>
            </section>
            
            <section id="results" style="display: none;">
                <div id="loading">
                    <div class="spinner"></div>
                    <p>ìš´ëª… ë¶„ì„ ì¤‘...</p>
                </div>
                <div id="analysis-results"></div>
            </section>
        </main>
    </div>
    
    <!-- JavaScript íŒŒì¼ë“¤ - ì¤‘ìš”: ìˆœì„œì™€ ê²½ë¡œ í™•ì¸ -->
    <script>
        // ì¸ë¼ì¸ìœ¼ë¡œ ê¸°ë³¸ ì´ˆê¸°í™” ì½”ë“œ ì¶”ê°€
        console.log('ğŸ”® ìš´ëª…í•™ ì‹œìŠ¤í…œ ì¸ë¼ì¸ ë¡œë”© ì‹œì‘');
        
        // ì „ì—­ ë³€ìˆ˜
        let analysisData = {};

        // DOM ë¡œë“œ ì™„ë£Œ ì‹œ ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', function() {
            console.log('âœ… DOM ë¡œë”© ì™„ë£Œ');
            initializeApp();
        });

        // ì•± ì´ˆê¸°í™”
        function initializeApp() {
            console.log('ğŸš€ ì•± ì´ˆê¸°í™” ì‹œì‘');
            
            // í¼ ìš”ì†Œ ì°¾ê¸°
            const form = document.getElementById('birth-form');
            if (form) {
                console.log('âœ… í¼ ì°¾ìŒ');
                form.addEventListener('submit', handleFormSubmit);
                console.log('âœ… í¼ ì´ë²¤íŠ¸ ì—°ê²°ë¨');
            } else {
                console.error('âŒ í¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ');
            }
            
            // ê¸°ë³¸ í¼ ì„¤ì •
            setupForm();
        }

        // í¼ ì„¤ì •
        function setupForm() {
            console.log('ğŸ“ í¼ ì„¤ì • ì‹œì‘');
            
            // ì¼ ì˜µì…˜ ìƒì„±
            const daySelect = document.getElementById('birth-day');
            if (daySelect) {
                for (let i = 1; i <= 31; i++) {
                    const option = document.createElement('option');
                    option.value = i.toString().padStart(2, '0');
                    option.textContent = i + 'ì¼';
                    daySelect.appendChild(option);
                }
                console.log('âœ… ì¼ ì˜µì…˜ ìƒì„± ì™„ë£Œ');
            }

            // ì‹œê°„ ì˜µì…˜ ìƒì„±
            const hourSelect = document.getElementById('birth-hour');
            if (hourSelect) {
                for (let i = 0; i < 24; i++) {
                    const option = document.createElement('option');
                    option.value = i.toString().padStart(2, '0');
                    option.textContent = i + 'ì‹œ';
                    hourSelect.appendChild(option);
                }
                console.log('âœ… ì‹œê°„ ì˜µì…˜ ìƒì„± ì™„ë£Œ');
            }

            // ë¶„ ì˜µì…˜ ìƒì„±
            const minuteSelect = document.getElementById('birth-minute');
            if (minuteSelect) {
                for (let i = 0; i < 60; i++) {
                    const option = document.createElement('option');
                    option.value = i.toString().padStart(2, '0');
                    option.textContent = i + 'ë¶„';
                    minuteSelect.appendChild(option);
                }
                console.log('âœ… ë¶„ ì˜µì…˜ ìƒì„± ì™„ë£Œ');
            }

            // ì„±ë³„ ë²„íŠ¼ ì´ë²¤íŠ¸
            document.querySelectorAll('.gender-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // ëª¨ë“  ë²„íŠ¼ ë¹„í™œì„±í™”
                    document.querySelectorAll('.gender-btn').forEach(b => b.classList.remove('active'));
                    
                    // í´ë¦­ëœ ë²„íŠ¼ í™œì„±í™”
                    this.classList.add('active');
                    
                    // ìˆ¨ê²¨ì§„ inputì— ê°’ ì„¤ì •
                    const genderInput = document.getElementById('gender');
                    if (genderInput) {
                        genderInput.value = this.dataset.value;
                        console.log('âœ… ì„±ë³„ ì„ íƒ:', this.dataset.value);
                    }
                });
            });
        }

        // í¼ ì œì¶œ ì²˜ë¦¬
        async function handleFormSubmit(event) {
            event.preventDefault();
            console.log('ğŸš€ í¼ ì œì¶œ ì‹œì‘');
            
            try {
                // ì…ë ¥ê°’ ìˆ˜ì§‘
                const year = document.getElementById('birth-year').value;
                const month = document.getElementById('birth-month').value;
                const day = document.getElementById('birth-day').value;
                const hour = document.getElementById('birth-hour').value;
                const minute = document.getElementById('birth-minute').value;
                const location = document.getElementById('birth-location').value;
                const gender = document.getElementById('gender').value;
                
                console.log('ğŸ“‹ ì…ë ¥ê°’:', { year, month, day, hour, minute, location, gender });
                
                const birthData = {
                    date: `${year}-${month}-${day}`,
                    time: `${hour}:${minute}`,
                    location: location,
                    gender: gender
                };
                
                // ìœ íš¨ì„± ê²€ì‚¬
                if (!validateInputs(birthData)) {
                    return;
                }
                
                console.log('âœ… ìœ íš¨ì„± ê²€ì‚¬ í†µê³¼');
                
                // ë¶„ì„ ì‹œì‘
                showLoadingScreen();
                await performAnalysis(birthData);
                showResults();
                
            } catch (error) {
                console.error('âŒ ë¶„ì„ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
                alert('ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                hideLoadingScreen();
            }
        }

        // ìœ íš¨ì„± ê²€ì‚¬
        function validateInputs(data) {
            console.log('ğŸ” ìœ íš¨ì„± ê²€ì‚¬:', data);
            
            if (!data.date || data.date.includes('null') || data.date === '--') {
                alert('ì¶œìƒë…„ì›”ì¼ì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return false;
            }
            
            if (!data.time || data.time.includes('null') || data.time === ':') {
                alert('ì¶œìƒì‹œê°„ì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return false;
            }
            
            if (!data.location || !data.location.trim()) {
                alert('ì¶œìƒì§€ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return false;
            }
            
            if (!data.gender) {
                alert('ì„±ë³„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return false;
            }
            
            return true;
        }

        // ë¡œë”© í™”ë©´ í‘œì‹œ
        function showLoadingScreen() {
            console.log('â³ ë¡œë”© í™”ë©´ í‘œì‹œ');
            document.getElementById('input-form').style.display = 'none';
            document.getElementById('results').style.display = 'block';
            document.getElementById('loading').style.display = 'block';
            document.getElementById('analysis-results').style.display = 'none';
        }

        // ë¡œë”© í™”ë©´ ìˆ¨ê¹€
        function hideLoadingScreen() {
            console.log('ğŸ”„ ë¡œë”© í™”ë©´ ìˆ¨ê¹€');
            document.getElementById('loading').style.display = 'none';
            document.getElementById('input-form').style.display = 'block';
            document.getElementById('results').style.display = 'none';
        }

        // ê²°ê³¼ í‘œì‹œ
        function showResults() {
            console.log('ğŸ“Š ê²°ê³¼ í‘œì‹œ');
            document.getElementById('loading').style.display = 'none';
            document.getElementById('analysis-results').style.display = 'block';
            
            const resultsDiv = document.getElementById('analysis-results');
            resultsDiv.innerHTML = generateResultsHTML();
        }

        // ë¶„ì„ ìˆ˜í–‰
        async function performAnalysis(birthData) {
            console.log('ğŸ”® ë¶„ì„ ì‹œì‘');
            
            updateLoadingMessage('ì²œë¬¸í•™ì  ê³„ì‚° ì¤‘...');
            await delay(1000);
            
            updateLoadingMessage('ì‚¬ì£¼íŒ”ì ë¶„ì„ ì¤‘...');
            await delay(1000);
            
            // ì‚¬ì£¼ ê³„ì‚°
            const baziResult = generateBaziData(birthData);
            
            updateLoadingMessage('ì„œì–‘ì ì„±ìˆ  ë¶„ì„ ì¤‘...');
            await delay(1000);
            
            const westernResult = generateWesternData(birthData);
            
            updateLoadingMessage('ì¢…í•© í•´ì„ ìƒì„± ì¤‘...');
            await delay(1000);
            
            analysisData = {
                birthInfo: birthData,
                bazi: baziResult,
                western: westernResult,
                summary: generateSummary(baziResult, birthData)
            };
            
            console.log('âœ… ë¶„ì„ ì™„ë£Œ:', analysisData);
        }

        // ë¡œë”© ë©”ì‹œì§€ ì—…ë°ì´íŠ¸
        function updateLoadingMessage(message) {
            const loadingText = document.querySelector('#loading p');
            if (loadingText) {
                loadingText.textContent = message;
                console.log('ğŸ“¢', message);
            }
        }

        // ì§€ì—° í•¨ìˆ˜
        function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // ì‚¬ì£¼ ë°ì´í„° ìƒì„±
        // ë²”ìš© ì‚¬ì£¼íŒ”ì ê³„ì‚° ì—”ì§„ - ëª¨ë“  ë‚ ì§œ ì§€ì›
// index.htmlì˜ generateBaziData í•¨ìˆ˜ë¥¼ ì´ê²ƒìœ¼ë¡œ ì™„ì „ êµì²´í•˜ì„¸ìš”

function generateBaziData(birthData) {
    console.log('ğŸ”® ë²”ìš© ì‚¬ì£¼ ê³„ì‚° ì‹œì‘:', birthData);
    
    const date = new Date(birthData.date + 'T' + birthData.time);
    const year = date.getFullYear();
    const month = date.getMonth() + 1;
    const day = date.getDate();
    const hour = date.getHours();
    const minute = date.getMinutes();
    
    console.log('ğŸ“… ì…ë ¥ ë‚ ì§œ:', { year, month, day, hour, minute });
    
    // ì‹¤ì œ ì‚¬ì£¼ ê³„ì‚°
    const yearPillar = calculateYearPillar(year);
    const monthPillar = calculateMonthPillar(year, month, day);
    const dayPillar = calculateDayPillar(year, month, day);
    const hourPillar = calculateHourPillar(hour, dayPillar);
    
    const result = {
        fourPillars: {
            year: yearPillar,
            month: monthPillar,
            day: dayPillar,
            hour: hourPillar
        },
        fiveElements: calculateFiveElements([yearPillar, monthPillar, dayPillar, hourPillar]),
        analysis: analyzeBazi(yearPillar, monthPillar, dayPillar, hourPillar),
        debug: {
            inputDate: birthData.date,
            inputTime: birthData.time,
            calculatedYear: year,
            calculatedMonth: month,
            calculatedDay: day,
            calculatedHour: hour
        }
    };
    
    console.log('âœ… ì‚¬ì£¼ ê³„ì‚° ì™„ë£Œ:', result);
    return result;
}

// ë…„ì£¼ ê³„ì‚° (ì‹¤ì œ 60ê°‘ì ìˆœí™˜)
function calculateYearPillar(year) {
    const tianGan = ['ç”²', 'ä¹™', 'ä¸™', 'ä¸', 'æˆŠ', 'å·±', 'åºš', 'è¾›', 'å£¬', 'ç™¸'];
    const diZhi = ['å­', 'ä¸‘', 'å¯…', 'å¯', 'è¾°', 'å·³', 'åˆ', 'æœª', 'ç”³', 'é…‰', 'æˆŒ', 'äº¥'];
    
    // ê¸°ì¤€: 1984ë…„ = ç”²å­ë…„ (ê°‘ìë…„)
    const baseYear = 1984;
    const yearDiff = year - baseYear;
    
    // 60ê°‘ì ìˆœí™˜ ê³„ì‚°
    let ganIndex = (yearDiff % 10 + 10) % 10;
    let zhiIndex = (yearDiff % 12 + 12) % 12;
    
    return tianGan[ganIndex] + diZhi[zhiIndex];
}

// ì›”ì£¼ ê³„ì‚° (ì ˆê¸° ê¸°ì¤€)
function calculateMonthPillar(year, month, day) {
    const tianGan = ['ç”²', 'ä¹™', 'ä¸™', 'ä¸', 'æˆŠ', 'å·±', 'åºš', 'è¾›', 'å£¬', 'ç™¸'];
    const diZhi = ['å¯…', 'å¯', 'è¾°', 'å·³', 'åˆ', 'æœª', 'ç”³', 'é…‰', 'æˆŒ', 'äº¥', 'å­', 'ä¸‘']; // ì •ì›”=å¯…ì›”ë¶€í„°
    
    // ì ˆê¸°í‘œ (ëŒ€ëµì )
    const solarTermDays = [
        4,  // 1ì›” - ì†Œí•œ(1/5ê²½)
        4,  // 2ì›” - ì…ì¶˜(2/4ê²½)  
        6,  // 3ì›” - ê²½ì¹©(3/6ê²½)
        5,  // 4ì›” - ì²­ëª…(4/5ê²½)
        6,  // 5ì›” - ì…í•˜(5/6ê²½)
        6,  // 6ì›” - ë§ì¢…(6/6ê²½)
        7,  // 7ì›” - ì†Œì„œ(7/7ê²½)
        8,  // 8ì›” - ì…ì¶”(8/8ê²½)
        8,  // 9ì›” - ë°±ë¡œ(9/8ê²½)
        8,  // 10ì›” - í•œë¡œ(10/8ê²½)
        7,  // 11ì›” - ì…ë™(11/7ê²½)
        7   // 12ì›” - ëŒ€ì„¤(12/7ê²½)
    ];
    
    // ì ˆê¸° ì „í›„ íŒë‹¨
    let monthIndex = month - 1; // 0ë¶€í„° ì‹œì‘
    if (day < solarTermDays[monthIndex]) {
        monthIndex = monthIndex - 1;
        if (monthIndex < 0) monthIndex = 11;
    }
    
    // ë…„ê°„ì— ë”°ë¥¸ ì›”ê°„ ê²°ì •
    const yearGan = calculateYearPillar(year)[0];
    const yearGanIndex = tianGan.indexOf(yearGan);
    
    // ì›”ê°„ ê³„ì‚° ê³µì‹
    const monthGanIndex = (yearGanIndex * 2 + monthIndex) % 10;
    
    return tianGan[monthGanIndex] + diZhi[monthIndex];
}

// ì¼ì£¼ ê³„ì‚° (ìœ¨ë¦¬ìš°ìŠ¤ ì ì¼ ê¸°ë°˜)
function calculateDayPillar(year, month, day) {
    const tianGan = ['ç”²', 'ä¹™', 'ä¸™', 'ä¸', 'æˆŠ', 'å·±', 'åºš', 'è¾›', 'å£¬', 'ç™¸'];
    const diZhi = ['å­', 'ä¸‘', 'å¯…', 'å¯', 'è¾°', 'å·³', 'åˆ', 'æœª', 'ç”³', 'é…‰', 'æˆŒ', 'äº¥'];
    
    // ìœ¨ë¦¬ìš°ìŠ¤ ì ì¼ ê³„ì‚°
    const julianDay = getJulianDay(year, month, day);
    
    // ê¸°ì¤€ì¼: JD 2299161 = 1582/10/15 = ç”²å­ì¼
    const baseJulianDay = 2299161;
    const dayOffset = julianDay - baseJulianDay;
    
    const ganIndex = (dayOffset % 10 + 10) % 10;
    const zhiIndex = (dayOffset % 12 + 12) % 12;
    
    return tianGan[ganIndex] + diZhi[zhiIndex];
}

// ìœ¨ë¦¬ìš°ìŠ¤ ì ì¼ ê³„ì‚°
function getJulianDay(year, month, day) {
    if (month <= 2) {
        year--;
        month += 12;
    }
    
    const a = Math.floor(year / 100);
    const b = 2 - a + Math.floor(a / 4);
    
    return Math.floor(365.25 * (year + 4716)) + 
           Math.floor(30.6001 * (month + 1)) + 
           day + b - 1524;
}

// ì‹œì£¼ ê³„ì‚°
function calculateHourPillar(hour, dayPillar) {
    const tianGan = ['ç”²', 'ä¹™', 'ä¸™', 'ä¸', 'æˆŠ', 'å·±', 'åºš', 'è¾›', 'å£¬', 'ç™¸'];
    const diZhi = ['å­', 'ä¸‘', 'å¯…', 'å¯', 'è¾°', 'å·³', 'åˆ', 'æœª', 'ç”³', 'é…‰', 'æˆŒ', 'äº¥'];
    
    // ì‹œê°„ëŒ€ë³„ ì§€ì§€ ë§¤í•‘
    const hourToZhi = [
        23, 1,   // 23-01ì‹œ = å­ì‹œ
        1, 3,    // 01-03ì‹œ = ä¸‘ì‹œ  
        3, 5,    // 03-05ì‹œ = å¯…ì‹œ
        5, 7,    // 05-07ì‹œ = å¯ì‹œ
        7, 9,    // 07-09ì‹œ = è¾°ì‹œ
        9, 11,   // 09-11ì‹œ = å·³ì‹œ
        11, 13,  // 11-13ì‹œ = åˆì‹œ
        13, 15,  // 13-15ì‹œ = æœªì‹œ
        15, 17,  // 15-17ì‹œ = ç”³ì‹œ
        17, 19,  // 17-19ì‹œ = é…‰ì‹œ
        19, 21,  // 19-21ì‹œ = æˆŒì‹œ
        21, 23   // 21-23ì‹œ = äº¥ì‹œ
    ];
    
    // ì‹œê°„ì— í•´ë‹¹í•˜ëŠ” ì§€ì§€ ì°¾ê¸°
    let zhiIndex = 0;
    if (hour >= 23 || hour < 1) zhiIndex = 0;      // å­
    else if (hour >= 1 && hour < 3) zhiIndex = 1;  // ä¸‘
    else if (hour >= 3 && hour < 5) zhiIndex = 2;  // å¯…
    else if (hour >= 5 && hour < 7) zhiIndex = 3;  // å¯
    else if (hour >= 7 && hour < 9) zhiIndex = 4;  // è¾°
    else if (hour >= 9 && hour < 11) zhiIndex = 5; // å·³
    else if (hour >= 11 && hour < 13) zhiIndex = 6; // åˆ
    else if (hour >= 13 && hour < 15) zhiIndex = 7; // æœª
    else if (hour >= 15 && hour < 17) zhiIndex = 8; // ç”³
    else if (hour >= 17 && hour < 19) zhiIndex = 9; // é…‰
    else if (hour >= 19 && hour < 21) zhiIndex = 10; // æˆŒ
    else if (hour >= 21 && hour < 23) zhiIndex = 11; // äº¥
    
    // ì¼ê°„ì— ë”°ë¥¸ ì‹œê°„ ì²œê°„ ê³„ì‚°
    const dayGan = dayPillar[0];
    const dayGanIndex = tianGan.indexOf(dayGan);
    
    // ì‹œê°„ ì²œê°„ ê³µì‹: (ì¼ê°„ Ã— 2 + ì‹œì§€) % 10
    const hourGanIndex = (dayGanIndex * 2 + zhiIndex) % 10;
    
    return tianGan[hourGanIndex] + diZhi[zhiIndex];
}

// ì˜¤í–‰ ë¶„ì„
function calculateFiveElements(pillars) {
    const wuXing = {
        // ì²œê°„ ì˜¤í–‰
        'ç”²': 'æœ¨', 'ä¹™': 'æœ¨', 'ä¸™': 'ç«', 'ä¸': 'ç«', 'æˆŠ': 'åœŸ',
        'å·±': 'åœŸ', 'åºš': 'é‡‘', 'è¾›': 'é‡‘', 'å£¬': 'æ°´', 'ç™¸': 'æ°´',
        // ì§€ì§€ ì˜¤í–‰
        'å­': 'æ°´', 'ä¸‘': 'åœŸ', 'å¯…': 'æœ¨', 'å¯': 'æœ¨', 'è¾°': 'åœŸ', 'å·³': 'ç«',
        'åˆ': 'ç«', 'æœª': 'åœŸ', 'ç”³': 'é‡‘', 'é…‰': 'é‡‘', 'æˆŒ': 'åœŸ', 'äº¥': 'æ°´'
    };
    
    const elements = { æœ¨: 0, ç«: 0, åœŸ: 0, é‡‘: 0, æ°´: 0 };
    
    pillars.forEach(pillar => {
        const gan = pillar[0]; // ì²œê°„
        const zhi = pillar[1]; // ì§€ì§€
        
        if (wuXing[gan]) elements[wuXing[gan]]++;
        if (wuXing[zhi]) elements[wuXing[zhi]]++;
    });
    
    return elements;
}

// ì‚¬ì£¼ ê¸°ë³¸ ë¶„ì„
function analyzeBazi(yearPillar, monthPillar, dayPillar, hourPillar) {
    const dayGan = dayPillar[0]; // ì¼ê°„ (ë‚˜ë¥¼ ë‚˜íƒ€ëƒ„)
    
    // ì¼ê°„ë³„ ê¸°ë³¸ ì„±ê²©
    const ganPersonality = {
        'ç”²': 'ë¦¬ë”ì‹­ì´ ê°•í•˜ê³  ì§„ì·¨ì ì´ë©°, ìƒˆë¡œìš´ ê²ƒì„ ì‹œì‘í•˜ëŠ” ëŠ¥ë ¥ì´ ë›°ì–´ë‚©ë‹ˆë‹¤.',
        'ä¹™': 'ë¶€ë“œëŸ½ê³  ìœ ì—°í•˜ë©°, ì˜ˆìˆ ì  ê°ê°ê³¼ ì„¬ì„¸í•¨ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.',
        'ä¸™': 'ë°ê³  í™œë°œí•˜ë©° ì‚¬êµì ì´ê³ , ë‚¨ì„ ë„ìš°ë ¤ëŠ” ë§ˆìŒì´ í½ë‹ˆë‹¤.',
        'ä¸': 'ì˜¨í™”í•˜ê³  ì‹ ì¤‘í•˜ë©°, ì •êµí•œ ì¼ì„ ì˜í•˜ê³  ë°°ë ¤ì‹¬ì´ ê¹ŠìŠµë‹ˆë‹¤.',
        'æˆŠ': 'ë¯¿ìŒì§í•˜ê³  ì•ˆì •ì ì´ë©°, í¬ìš©ë ¥ì´ ìˆê³  í˜„ì‹¤ì ì…ë‹ˆë‹¤.',
        'å·±': 'ì‹ ì¤‘í•˜ê³  ê¼¼ê¼¼í•˜ë©°, ì¸ë‚´ì‹¬ì´ ê°•í•˜ê³  ê³„íšì ì…ë‹ˆë‹¤.',
        'åºš': 'ì˜ì§€ê°€ ê°•í•˜ê³  ê²°ë‹¨ë ¥ì´ ìˆìœ¼ë©°, ì •ì˜ê°ì´ ê°•í•©ë‹ˆë‹¤.',
        'è¾›': 'ì„¸ë ¨ë˜ê³  í’ˆìœ„ê°€ ìˆìœ¼ë©°, ë¯¸ì  ê°ê°ì´ ë›°ì–´ë‚©ë‹ˆë‹¤.',
        'å£¬': 'ì§€í˜œë¡­ê³  ìœµí†µì„±ì´ ìˆìœ¼ë©°, í¬ìš©ë ¥ì´ í¬ê³  ì ì‘ë ¥ì´ ë›°ì–´ë‚©ë‹ˆë‹¤.',
        'ç™¸': 'ì°¨ë¶„í•˜ê³  ë‚´ì„±ì ì´ë©°, ê¹Šì´ ìˆëŠ” ì‚¬ê³ ë¥¼ í•˜ê³  ì¸ë‚´ì‹¬ì´ ê°•í•©ë‹ˆë‹¤.'
    };
    
    // ê³„ì ˆ ë¶„ì„
    const monthZhi = monthPillar[1];
    const season = getSeasonByMonthZhi(monthZhi);
    
    return {
        dayMaster: dayGan,
        personality: ganPersonality[dayGan] || 'ë…íŠ¹í•˜ê³  ê°œì„±ì ì¸ ì„±í–¥ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.',
        season: season,
        strength: calculateDayMasterStrength(dayGan, monthZhi),
        luckyElements: determineLuckyElements(dayGan, season)
    };
}

// ê³„ì ˆ íŒë‹¨
function getSeasonByMonthZhi(monthZhi) {
    const seasons = {
        'å¯…': 'ë´„', 'å¯': 'ë´„', 'è¾°': 'ë´„',
        'å·³': 'ì—¬ë¦„', 'åˆ': 'ì—¬ë¦„', 'æœª': 'ì—¬ë¦„', 
        'ç”³': 'ê°€ì„', 'é…‰': 'ê°€ì„', 'æˆŒ': 'ê°€ì„',
        'äº¥': 'ê²¨ìš¸', 'å­': 'ê²¨ìš¸', 'ä¸‘': 'ê²¨ìš¸'
    };
    
    return seasons[monthZhi] || 'ì‚¬ê³„ì ˆ';
}

// ì¼ê°„ ê°•ì•½ íŒë‹¨ (ê°„ë‹¨ ë²„ì „)
function calculateDayMasterStrength(dayGan, monthZhi) {
    const ganElement = {
        'ç”²': 'æœ¨', 'ä¹™': 'æœ¨', 'ä¸™': 'ç«', 'ä¸': 'ç«', 'æˆŠ': 'åœŸ',
        'å·±': 'åœŸ', 'åºš': 'é‡‘', 'è¾›': 'é‡‘', 'å£¬': 'æ°´', 'ç™¸': 'æ°´'
    };
    
    const zhiElement = {
        'å¯…': 'æœ¨', 'å¯': 'æœ¨', 'è¾°': 'åœŸ', 'å·³': 'ç«', 'åˆ': 'ç«', 'æœª': 'åœŸ',
        'ç”³': 'é‡‘', 'é…‰': 'é‡‘', 'æˆŒ': 'åœŸ', 'äº¥': 'æ°´', 'å­': 'æ°´', 'ä¸‘': 'åœŸ'
    };
    
    const element = ganElement[dayGan];
    const monthElement = zhiElement[monthZhi];
    
    if (element === monthElement) {
        return 'ê°•í•¨ (ë“ë ¹)';
    } else if (isElementSupported(element, monthElement)) {
        return 'ë³´í†µ (ë„ì›€ë°›ìŒ)';
    } else {
        return 'ì•½í•¨ (ê·¹ì„ ë°›ìŒ)';
    }
}

// ì˜¤í–‰ ìƒìƒ ê´€ê³„ íŒë‹¨
function isElementSupported(element1, element2) {
    const support = {
        'æœ¨': 'æ°´', // ëª©ì€ ìˆ˜ìƒëª©
        'ç«': 'æœ¨', // í™”ëŠ” ëª©ìƒí™”
        'åœŸ': 'ç«', // í† ëŠ” í™”ìƒí† 
        'é‡‘': 'åœŸ', // ê¸ˆì€ í† ìƒê¸ˆ
        'æ°´': 'é‡‘'  // ìˆ˜ëŠ” ê¸ˆìƒìˆ˜
    };
    
    return support[element1] === element2;
}

// ìš©ì‹  ê²°ì • (ê°„ë‹¨ ë²„ì „)
function determineLuckyElements(dayGan, season) {
    const ganElement = {
        'ç”²': 'æœ¨', 'ä¹™': 'æœ¨', 'ä¸™': 'ç«', 'ä¸': 'ç«', 'æˆŠ': 'åœŸ',
        'å·±': 'åœŸ', 'åºš': 'é‡‘', 'è¾›': 'é‡‘', 'å£¬': 'æ°´', 'ç™¸': 'æ°´'
    };
    
    const element = ganElement[dayGan];
    
    // ê³„ì ˆë³„ ìš©ì‹  (ë§¤ìš° ê°„ë‹¨í™”)
    const seasonalNeeds = {
        'ë´„': ['ç«', 'åœŸ'], // ë´„ì—ëŠ” ë”°ëœ»í•¨ê³¼ ì•ˆì •ì´ í•„ìš”
        'ì—¬ë¦„': ['æ°´', 'é‡‘'], // ì—¬ë¦„ì—ëŠ” ì‹œì›í•¨ì´ í•„ìš”
        'ê°€ì„': ['ç«', 'æœ¨'], // ê°€ì„ì—ëŠ” ë”°ëœ»í•¨ê³¼ ìƒê¸°ê°€ í•„ìš”
        'ê²¨ìš¸': ['ç«', 'æœ¨']  // ê²¨ìš¸ì—ëŠ” ë”°ëœ»í•¨ê³¼ ìƒê¸°ê°€ í•„ìš”
    };
    
    return seasonalNeeds[season] || ['åœŸ'];
}

// í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ - ì‹¤ì œ ì‚¬ì£¼ì™€ ë¹„êµ
function testCalculation() {
    console.log('ğŸ§ª ì‚¬ì£¼ ê³„ì‚° í…ŒìŠ¤íŠ¸ ì‹œì‘');
    
    // í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë“¤
    const testCases = [
        {
            name: '1978ë…„ 12ì›” 6ì¼ 15ì‹œ',
            data: { date: '1978-12-06', time: '15:01' },
            expected: { year: 'æˆŠåˆ', month: 'ç™¸äº¥', day: 'å£¬å¯…', hour: 'ä¸æœª' }
        },
        {
            name: '1990ë…„ 1ì›” 1ì¼ 12ì‹œ',
            data: { date: '1990-01-01', time: '12:00' },
            expected: null // ë¹„êµê°’ ì—†ìŒ
        }
    ];
    
    testCases.forEach(testCase => {
        console.log(`\ní…ŒìŠ¤íŠ¸: ${testCase.name}`);
        const result = generateBaziData(testCase.data);
        console.log('ê³„ì‚° ê²°ê³¼:', result.fourPillars);
        
        if (testCase.expected) {
            console.log('ì˜ˆìƒ ê²°ê³¼:', testCase.expected);
            console.log('ì¼ì¹˜ ì—¬ë¶€:', 
                result.fourPillars.year === testCase.expected.year &&
                result.fourPillars.day === testCase.expected.day
            );
        }
    });
}

// ë¸Œë¼ìš°ì € ì½˜ì†”ì—ì„œ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ê°€ëŠ¥
// ì‚¬ìš©ë²•: testCalculation()

console.log('âœ… ë²”ìš© ì‚¬ì£¼íŒ”ì ê³„ì‚° ì—”ì§„ ë¡œë”© ì™„ë£Œ');

        // ì„œì–‘ì ì„±ìˆ  ë°ì´í„° ìƒì„±
        function generateWesternData(birthData) {
            const date = new Date(birthData.date);
            const month = date.getMonth() + 1;
            const day = date.getDate();
            
            let sunSign = 'ì–‘ìë¦¬';
            if (month === 12 && day >= 22 || month === 1 && day <= 19) sunSign = 'ì—¼ì†Œìë¦¬';
            else if (month === 1 && day >= 20 || month === 2 && day <= 18) sunSign = 'ë¬¼ë³‘ìë¦¬';
            else if (month === 2 && day >= 19 || month === 3 && day <= 20) sunSign = 'ë¬¼ê³ ê¸°ìë¦¬';
            else if (month === 3 && day >= 21 || month === 4 && day <= 19) sunSign = 'ì–‘ìë¦¬';
            else if (month === 4 && day >= 20 || month === 5 && day <= 20) sunSign = 'í™©ì†Œìë¦¬';
            else if (month === 5 && day >= 21 || month === 6 && day <= 20) sunSign = 'ìŒë‘¥ì´ìë¦¬';
            else if (month === 6 && day >= 21 || month === 7 && day <= 22) sunSign = 'ê²Œìë¦¬';
            else if (month === 7 && day >= 23 || month === 8 && day <= 22) sunSign = 'ì‚¬ììë¦¬';
            else if (month === 8 && day >= 23 || month === 9 && day <= 22) sunSign = 'ì²˜ë…€ìë¦¬';
            else if (month === 9 && day >= 23 || month === 10 && day <= 22) sunSign = 'ì²œì¹­ìë¦¬';
            else if (month === 10 && day >= 23 || month === 11 && day <= 21) sunSign = 'ì „ê°ˆìë¦¬';
            else if (month === 11 && day >= 22 || month === 12 && day <= 21) sunSign = 'ì‚¬ìˆ˜ìë¦¬';
            
            const signs = ['ì–‘ìë¦¬', 'í™©ì†Œìë¦¬', 'ìŒë‘¥ì´ìë¦¬', 'ê²Œìë¦¬', 'ì‚¬ììë¦¬', 'ì²˜ë…€ìë¦¬', 
                           'ì²œì¹­ìë¦¬', 'ì „ê°ˆìë¦¬', 'ì‚¬ìˆ˜ìë¦¬', 'ì—¼ì†Œìë¦¬', 'ë¬¼ë³‘ìë¦¬', 'ë¬¼ê³ ê¸°ìë¦¬'];
            
            return {
                sunSign: sunSign,
                moonSign: signs[Math.floor(Math.random() * 12)],
                ascendant: signs[Math.floor(Math.random() * 12)]
            };
        }

        // ì¢…í•© ìš”ì•½ ìƒì„±
        function generateSummary(baziResult, birthData) {
            return {
                personality: 'ì°½ì˜ì ì´ê³  ì§ê´€ì ì¸ ì„±í–¥ì„ ê°€ì§€ê³  ìˆìœ¼ë©°, ê°ì •ì´ í’ë¶€í•˜ê³  ì˜ˆìˆ ì  ê°ê°ì´ ë›°ì–´ë‚©ë‹ˆë‹¤.',
                strengths: [
                    'ë›°ì–´ë‚œ ì§ê°ë ¥ê³¼ í†µì°°ë ¥',
                    'ì°½ì˜ì  ì‚¬ê³ ì™€ ì˜ˆìˆ ì  ê°ê°',
                    'ê¹Šì€ ê³µê°ëŠ¥ë ¥ê³¼ ì´í•´ì‹¬'
                ],
                challenges: [
                    'ë•Œë¡œëŠ” ì™„ë²½ì£¼ì˜ ì„±í–¥',
                    'ê°ì •ì˜ ê¸°ë³µ ê´€ë¦¬ í•„ìš”',
                    'ê²°ì • ë‚´ë¦¬ê¸°ë¥¼ ì–´ë ¤ì›Œí•¨'
                ],
                advice: 'ë‚´ë©´ì˜ ëª©ì†Œë¦¬ì— ê·€ ê¸°ìš¸ì´ê³ , ëª…ìƒì´ë‚˜ ìš”ê°€ë¥¼ í†µí•´ ë§ˆìŒì˜ í‰ì •ì„ ì°¾ìœ¼ì„¸ìš”. ì°½ì‘ í™œë™ì„ í†µí•´ ê°ì •ì„ í‘œí˜„í•˜ëŠ” ê²ƒì´ ë„ì›€ì´ ë  ê²ƒì…ë‹ˆë‹¤.'
            };
        }

        // ê²°ê³¼ HTML ìƒì„±
        function generateResultsHTML() {
            const bazi = analysisData.bazi;
            const western = analysisData.western;
            const summary = analysisData.summary;
            
            return `
                <h2>ğŸŒŸ ì¢…í•© ìš´ëª… ë¶„ì„ ê²°ê³¼</h2>
                
                <div class="result-section">
                    <h3>ğŸ“Š ì‚¬ì£¼íŒ”ì</h3>
                    <div class="bazi-chart">
                        <div class="pillar">
                            <div class="pillar-label">ë…„ì£¼</div>
                            <div class="pillar-value">${bazi.fourPillars.year}</div>
                        </div>
                        <div class="pillar">
                            <div class="pillar-label">ì›”ì£¼</div>
                            <div class="pillar-value">${bazi.fourPillars.month}</div>
                        </div>
                        <div class="pillar">
                            <div class="pillar-label">ì¼ì£¼</div>
                            <div class="pillar-value">${bazi.fourPillars.day}</div>
                        </div>
                        <div class="pillar">
                            <div class="pillar-label">ì‹œì£¼</div>
                            <div class="pillar-value">${bazi.fourPillars.hour}</div>
                        </div>
                    </div>
                    
                    <h4>ğŸŒŠ ì˜¤í–‰ ë¶„í¬</h4>
                    <div class="elements-chart">
                        ${Object.entries(bazi.fiveElements).map(([element, count]) => 
                            `<div class="element-item">
                                <span class="element-name">${element}</span>
                                <span class="element-count">${count}ê°œ</span>
                                <div class="element-bar" style="width: ${count * 20}%; height: 20px; background: linear-gradient(90deg, #667eea, #764ba2); border-radius: 10px; margin-left: 10px;"></div>
                            </div>`
                        ).join('')}
                    </div>
                </div>
                
                <div class="result-section">
                    <h3>ğŸŒŸ ì„œì–‘ì ì„±ìˆ </h3>
                    <p><strong>íƒœì–‘:</strong> ${western.sunSign}</p>
                    <p><strong>ë‹¬:</strong> ${western.moonSign}</p>
                    <p><strong>ìƒìŠ¹:</strong> ${western.ascendant}</p>
                </div>
                
                <div class="result-section">
                    <h3>ğŸ’ ì¢…í•© ë¶„ì„</h3>
                    <h4>ì„±ê²© íŠ¹ì„±</h4>
                    <p>${summary.personality}</p>
                    
                    <h4>ê°•ì </h4>
                    <ul>
                        ${summary.strengths.map(strength => `<li>${strength}</li>`).join('')}
                    </ul>
                    
                    <h4>ë„ì „ ê³¼ì œ</h4>
                    <ul>
                        ${summary.challenges.map(challenge => `<li>${challenge}</li>`).join('')}
                    </ul>
                    
                    <h4>ğŸ’¡ ì¸ìƒ ì¡°ì–¸</h4>
                    <p>${summary.advice}</p>
                </div>
                
                <div style="text-align: center; margin-top: 30px;">
                    <button onclick="startNewAnalysis()" style="background: #718096; color: white; padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; margin-right: 10px;">
                        ğŸ”„ ìƒˆë¡œ ë¶„ì„í•˜ê¸°
                    </button>
                    <button onclick="alert('PDF ê¸°ëŠ¥ì€ ê³§ ì¶”ê°€ë©ë‹ˆë‹¤!')" style="background: #38a169; color: white; padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer;">
                        ğŸ“„ PDF ì €ì¥
                    </button>
                </div>
            `;
        }

        // ìƒˆ ë¶„ì„ ì‹œì‘
        function startNewAnalysis() {
            console.log('ğŸ”„ ìƒˆ ë¶„ì„ ì‹œì‘');
            
            document.getElementById('results').style.display = 'none';
            document.getElementById('input-form').style.display = 'block';
            document.getElementById('birth-form').reset();
            
            // ì„±ë³„ ë²„íŠ¼ ì´ˆê¸°í™”
            document.querySelectorAll('.gender-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById('gender').value = '';
        }

        console.log('âœ… ì¸ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸ ë¡œë”© ì™„ë£Œ');
    </script>
</body>
</html>
